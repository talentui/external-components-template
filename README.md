# 背景

`pageBuilder`作为一款页面构建工具，其价值的体现依托于丰富多样的组件，以此来随心所欲的创建页面。

在`upaas`项目中，我们引入了`pageBuilder`,并开发了各种各样的组件，推出了泫然一新的首页。但是在炫酷的背后，我们在组件开发中却面临着几个痛点：

由于组件是和项目一起构建的，所以这就导致了：
1. 随着组件的增多，项目体积越来越大，构建速度越来越慢
2. 由于组件bug而导致的问题，必须将项目重新发版上线，哪怕是一个小小的UI bug
3. 在upaas项目开发中，有其他的产品线也想用pageBuilder展示他们的组件，构建他们自己页面，那他们必须要在upaas项目中开发组件。这显然是不合理的。

![](http://note.youdao.com/yws/api/personal/file/WEB8f4b6f0eae43bf02a4338b8c141bce68?method=download&shareKey=85686db2bf65f63188108e95ffc1c8ed)

上面几个问题的背后，似乎都聚焦在同一个点上：组件和项目是一起构建的。如果将这个问题解决掉，让组件单独开发，单独构建，单独发版，上面的问题似乎都迎刃而解。

# 流程

优化之后，将组件开和项目开发解耦，提高维护性，方便组件后续的更新和发版, 流程如下：

![](http://note.youdao.com/yws/api/personal/file/WEB502f6cc8286098cb8c66afb542afdaed?method=download&shareKey=8081871980bd27e35cf9d788fa66f6b6)

**注意**
1.  `pageBuilder`应用就是单独一个`pageBuilder`项目，项目内不包含任何的组件代码，所有的组件都是通过外部引入的的方式，引入到项目中

2. 这里的组件开发不是指一个单独的组件，而是某产品线下开发的所有pageBuilder组件的集合，包括：`展示组件`，`属性组件`，还有`页面模版组件`。一个产品线下的pageBuilder组件，对应一份`js`文件

把整体的流程理顺之后，我们再来看一下在每一个环节之下需要解决哪些问题：
## 1. 组件开发

1. **开发规范**：pageBuilder有一套完整的组件开发规范，文档也在持续更新和完善
2. **模版项目**：需要有一个模版项目，内置完整的构建流程，让开发者在该项目内开发和调试组件
3. **组件调试**：需要有一套本地开发和调试环境的配置，让开发者调试组件接口
4. **组件依赖**：这里使用`dll`解决组件依赖(如react)重复打包的问题。对于dll内没有的依赖，在构建时将其打包到组件中。

## 2. 组件构建

1. **构建工具**： 需要提供一套完整的构建流程，将组件打包为约定的格式(`UMD`)，方便其引入和访问
2. **静态资源打包的问题**：publicPath

## 3. 注册组件信息

1. **全局变量名称**：名称规范？ 如 `UPAA_PB_COMPONENT`
2. **线上资源地址**：`js`  `css`
3. **注册组件列表**：开发者将开发的组件的具体信息注册到组件列表，包括组件名称，name，以及尺寸，URL等其他信息
```
{
    //注册流程和注册细节待完善
    name:'',
    displayTitle:'',
    initalSize:''
}
```

## 4. 将组件资源引入到pageBuilder应用

我们是以`UMD`的方式将组件打包，`js` 资源以 `script` 标签的的形式引入到pageBuilder页面，然后通过全局变量访问该产品线下的组件数据.



## 问题
1. 新的打包方案是否需要区分生产和开发环境，打包出的文件带版本号，实现版本控制
2. 在pageBuilder内如何知道从哪个全局变量下取组件，后端从页面打值？
3. 如果在pageBuilder中需要同时展示两个应用下开发的组件 如upaas 和薪酬，how?
4. umd 命名规范  保证唯一性
5. npm version api 
6. 模版项目的问题：创建一个模版项目，并接入ci  ci触发hook的问题
7. 单个组件的版本控制问题，回滚问题